<html>
	<head>
		<meta charset="utf-8" />
		<title>股票程序化交易系统</title>
		<link href="/public/styles/reset.css" rel="stylesheet" type="text/css" />
    	<link href="/public/styles/index/style.css" rel="stylesheet" type="text/css" />
    	<script language="javascript" type="text/javascript" src="/json2.js"></script>

<script language="javascript" type="text/javascript" src="/public/js/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="/public/js/jquery.jqplot.min.js"></script>
<script type="text/javascript" src="/public/js/jquery-ui-1.8.21.custom.min.js"></script>

<script type="text/javascript" src="/public/js/jquery.crypt.js"></script>
<script type="text/javascript" src="/public/js/plugins/jqplot.pieRenderer.min.js"></script>
<script type="text/javascript" src="/public/js/plugins/jqplot.donutRenderer.min.js"></script>
<script type="text/javascript" src="/public/js/plugins/jqplot.canvasTextRenderer.min.js"></script>
<script type="text/javascript" src="/public/js/plugins/jqplot.highlighter.min.js"></script>
<script type="text/javascript" src="/public/js/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
<script type="text/javascript" src="/public/js/plugins/jqplot.barRenderer.min.js"></script>
<script type="text/javascript" src="/public/js/plugins/jqplot.categoryAxisRenderer.min.js"></script>
<script type="text/javascript" src="/public/js/plugins/jqplot.pointLabels.min.js"></script>




<style type="text/css" media="screen">
@import "/public/js/plugins/DataTables-1.9.2/media/css/demo_page.css";
@import "/public/js/plugins/DataTables-1.9.2/media/css/demo_table_jui.css";
</style>
<script type="text/javascript" src="/public/js/plugins/DataTables-1.9.2/media/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" type="text/css" href="/public/js/css/smoothness/jquery-ui-1.8.21.custom.css" />
<link rel="stylesheet" type="text/css" href="/public/js/jquery.jqplot.min.css" />

<script type="text/javascript">
//nameSpace
var oojs$ = {
	ns: function(space) {
		var names = (space + '').split(".");
		var objs = this;
		for ( var i = 0; i < names.length; i++) {
			var subName = names[i];
			var subType = typeof (objs[subName]);
			if (subType != 'object' && subType != 'undefined') {
				throw "Invalid namespace " + space + ", sub: " + subName;
			}
			objs = objs[subName] = objs[subName] || {};
		}
	}

	,createClass: function(value)
	{
		var cls = function()
		{
			if(typeof(this.__ctor) == 'function')
			{
				this.__ctor.apply(this,arguments);
			}
		};
		cls.prototype = cls.prototype || {};
		var type = 0;
		var fname;
		var get_set_obj = {};
		for(var name in value)
		{
			if(name.indexOf('getter_') === 0)
			{
				fname = name.split('_')[1];
				type = 1;
		}
		else if(name.indexOf('setter_') === 0)
		{
			fname = name.split('_')[1];
			type = 2;
		}
		else
		{
			type = 0;
		}

		switch(type)
		{
			case 0:
				cls.prototype[name] = value[name];
				break;
			case 1:
				get_set_obj[fname] = get_set_obj[fname] || {};
				get_set_obj[fname].get = value[name];
				break;
			case 2:
				get_set_obj[fname] = get_set_obj[fname] || {};
				get_set_obj[fname].set = value[name];
				break;
			}
		}
	
		for(var i in get_set_obj)
		{
			Object.defineProperty(cls.prototype,i,{
			get:get_set_obj[i].get,
			set:get_set_obj[i].set
			});
		}
		return cls;
	}

	,distroyClass: function(namespace,className)
	{
		var names = (namespace + '').split(".");
		var objs = this;
		for( var i = 0; i < names.length; i ++ )
		{
			var subName = names[i];
			var subType = typeof(objs[subName]);
			if( subType == 'object'  )
			{
				if(i < names.length-1)
				{
					objs = objs[subName];
					continue;
				}else if(i == names.length-1 ){
					objs = objs[subName];
					objs[className] = null;
					delete objs[className];
				}
			}else{
				throw "Invalid namespace " + namespace;
			}
		}
	}
    ,changeToStar: function(letter){
        var size = letter.length;
        var newLetter = '';
        if(size>2){
            newLetter += letter.substr(0,2)+"******"
        }else{
            newLetter += '********'
        }
        return newLetter;
    }
    /*****
    * <input id="upload-input" type="file" name="uploads_name" multiple="multiple"></br>
    * <button class="btn btn-lg upload-btn" type="button">Upload File</button>
    * $('.upload-btn').on('click', function (){
    *   $('#upload-input').click();
    *   //$('.progress-bar').text('0%');
    *   //$('.progress-bar').width('0%');
    * });
    * $('#upload-input').on('change', function(){
    *   var files = $(this).get(0).files;
    *   oojs$.http_upload( 'uploads_name', files, function(percent){
    *       console.log(percent);
    *   })
    *  })
    */
    ,http_upload: function(  name, files, callback, percentback){

        if (files.length > 0){
            var formData = new FormData();
            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                formData.append(name, file, file.name);
            }   
            $.ajax({
                url: '/upload',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(result){
                    // console.log('upload successful!\n' + result);
                    if(callback){
                        callback(result);
                    }
                },
                xhr: function() {
                    // create an XMLHttpRequest
                    var xhr = new XMLHttpRequest();

                    // listen to the 'progress' event
                    xhr.upload.addEventListener('progress', function(evt) {

                        if (evt.lengthComputable) {
                            // calculate the percentage of upload completed
                            var percentComplete = evt.loaded / evt.total;
                            percentComplete = parseInt(percentComplete * 100);
                            if(percentback){
                                percentback(percentComplete);
                            }
                            // if (percentComplete === 100) {
                            // }
                        }
                    }, false);
                    return xhr;
                }
            });
        }else{
            oojs$.showError("没有选择文件");
        }
    }
    
	,httpPost_json: function( send_url, send_jsonObj, callback, token ){
        $.ajax({
            type:"post",
            url:send_url,
            async:false,
            dataType:"json",
            data:JSON.stringify(send_jsonObj),
            success:function(result, textStatus){
				if(callback){
                    callback(result, textStatus, token);
                }
            },
            beforeSend: function(xhr){
                xhr.withCredentials = true;
            }
        });
	}

	,httpGet: function(send_url, callback, token){
        $.ajax({
            type:"get",
            url:send_url,
            async:false,
            dataType:"json",
            success:function(result, textStatus){
                if(callback){
                    callback(result, textStatus, token);
                }
            },
            beforeSend: function(xhr){
                xhr.withCredentials = true;
            }
        });
	}

	,Format: function(_date,fmt) { // author: meizz
        var o = {
            "M+" : _date.getMonth() + 1, // 月份
            "d+" : _date.getDate(), // 日
            "H+" : _date.getHours(), // 小时
            "m+" : _date.getMinutes(), // 分
            "s+" : _date.getSeconds(), // 秒
            "q+" : Math.floor((_date.getMonth() + 3) / 3), // 季度
            "S" : _date.getMilliseconds()
            // 毫秒
        };

        if (/(y+)/.test(fmt)){
            fmt = fmt.replace(RegExp.$1, (_date.getFullYear() + "")
                .substr(4 - RegExp.$1.length));
        }

        for ( var k in o) {
            if (new RegExp("(" + k + ")").test(fmt)){
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k])
                    : (("00" + o[k]).substr(("" + o[k]).length)));
            }
        }
        return fmt;
    }

	,matchYMD: function(myd,type){
		if(!myd){
            return false;
		}
        type = type||2;
        var yearReg = '(20[0-9][0-9]|20[0-9][0-9])';            ///< Allows a number between 2014 and 2029
        var monthReg = '(0[1-9]|1[0-2])';               ///< Allows a number between 00 and 12
        var dayReg = '(0[1-9]|1[0-9]|2[0-9]|3[0-1])';   ///< Allows a number between 00 and 31
        var hourReg = '([0-1][0-9]|2[0-3])';            ///< Allows a number between 00 and 24
        var minReg = '([0-5][0-9])';                    ///< Allows a number between 00 and 59
        var reg1 = new RegExp('^' + yearReg + '-' + monthReg + '-' + dayReg + ' ' + hourReg + ':' + minReg + '$', 'g');
        var reg2 = new RegExp('^' + yearReg + '-' + monthReg + '-' + dayReg + '$', 'g');
        var reg = null;
        if(type == 1){
            reg = reg1;
        }else{
            reg = reg2;
        }
        if( !myd.match(reg) ){
            return false;
        }else{
            return true;
        }
    }

    ,valideStock: function(){
        if(arguments[0].match(/^[a-zA-Z0-9]{6}$/)){
            return true;
        }else{
            return false;
        }
    }
    /***
    * oojs$.toHMSOBJ(time)
    */
    ,toHMSOBJ: function(){
        var shortTime = arguments[0];
        var obj = {hh:0,mm:0,ss:0};
        if( shortTime === undefined || shortTime === null ){
            return obj;
        }
        if(parseInt(shortTime)<0 || parseInt(shortTime)> 24*60*60 ){
            return obj;
        }

        obj['hh'] = Math.floor( parseInt(shortTime)/(60*60) );
        obj['mm'] = Math.floor( parseInt(shortTime)%(60*60)/60 );
        obj['ss'] = parseInt(shortTime)%60;

        return obj;
    }
    /***
    * oojs$.toHMS(time)
    */
    ,toHMS: function(){
        var shortTime = arguments[0];
        var obj = {hh:0,mm:0,ss:0};
        if( shortTime === undefined || shortTime === null ){
            return obj;
        }
        if(parseInt(shortTime)<0 || parseInt(shortTime)> 24*60*60 ){
            return obj;
        }

        obj['hh'] = Math.floor( parseInt(shortTime)/(60*60) );
        obj['mm'] = Math.floor( parseInt(shortTime)%(60*60)/60 );
        obj['ss'] = parseInt(shortTime)%60;

        return obj['hh']+":"+obj['mm']+":"+obj['ss'];
    }
    /**
    * usage
    * oojs$.generateHMDOption(div)
    * 
    */
    ,generateHMDOption: function(){
		var htmltag = arguments[0];
        var type = '';
        if(arguments.length>1){
            type = arguments[1];
        }

		htmltag.empty();

        if(type!='' && type == 'datepicker')
        {
            var input = $('<input></input>',{
                'type':'text'
            }).datepicker({ dateFormat: 'yy年mm月dd日' });
            input.datepicker('setDate',new Date());
            htmltag.append(input);
        }

		var tmpval = '';
        var select=null;

        htmltag.append($('<label>时</label>'));
        select= $('<select ></select>',{
            style:"height:25px;width:50px;-webkit-appearance: none;"
        });
		for(var i = 0; i < 24; i++){
            tmpval = i<=9?("0"+i):i;
            select.append("<option value='"
                +tmpval+"'>"
                +tmpval+"</option>");
		}
        htmltag.append(select);

        htmltag.append($('<label>:分</label>'));

        select= $('<select ></select>',{
            style:"height:25px;width:50px;-webkit-appearance: none;"
        });
        for(var i = 0; i < 60; i++){

            tmpval = i<=9?("0"+i):i;
            select.append("<option value='"
                +tmpval+"'>"
                +tmpval+"</option>");
        }
        htmltag.append(select);

        htmltag.append($('<label>:秒</label>'));

        select= $('<select></select>',{
            style:"height:25px;width:50px;-webkit-appearance: none;"
        });
        for(var i = 0; i < 60; i++){
            tmpval = i<=9?("0"+i):i;
            select.append("<option value='"
                +tmpval+"'>"
                +tmpval+"</option>");
        }
        htmltag.append(select);

		return htmltag;
	}

    ,showInfo:function (text,callback) {

		/**
		 *<div id="dialog" title="提示" style="display:none;">
         *<p id="dialogtext" style=""></p>
         *</div>
		 * */
        $("#dialogtext").text(text);
        $( "#dialog" ).dialog({
            closeOnEscape: false
            ,
            
            resizable: false
            ,
            height: "auto"
            ,
            width: 400
            ,
            modal: true
            ,
            open: function(event, ui) {
                $(".ui-dialog-titlebar-close", ui.dialog | ui).hide();
            }
            ,
            buttons: {
                "确定": function() {

                    $( this ).dialog( "close" );
                    if(callback){
                        callback("yes");
                    }
                },
                "取消": function() {
                    $( this ).dialog( "close" );
                    if(callback){
                        callback("no");
                    }
                }
            }
        });
    }

	,showError:function (text,callback) {
        /**
         *<div id="dialog" title="提示" style="display:none;">
         *<p id="dialogtext" style=""></p>
         *</div>
         * */
        $("#dialogtext").text(text);
        $("#dialog").dialog({
            closeOnEscape: false
            ,
            open: function(event, ui) {
                $(".ui-dialog-titlebar-close", ui.dialog | ui).hide();
            }
            ,
            buttons: {
                "Ok":function(){$(this).dialog("close");if(callback){callback()};}
            }
            ,
            modal:true
        });
    }

	,apply : function(dest, source) {
		for ( var name in source) {
			dest[name] = source[name];
		}
		return dest;
	}
	
	,applyIf : function(dest, source) {
		for ( var name in source) {
			if (typeof (dest[name]) == 'undefined') {
				dest[name] = source[name];
			}
		}
		return dest;
	}

    ,getCookie: function (name) {
        function escape(s) { return s.replace(/([.*+?\^${}()|\[\]\/\\])/g, '\\$1'); };
        var match = document.cookie.match(RegExp('(?:^|;\\s*)' + escape(name) + '=([^;]*)'));
        return match ? match[1] : null;
    }

    /****
    * oojs$.sendMessage({'type':"helloe",'other':'something'})
    *
    *
    **/
    ,_ws:null
    ,_ws_catch:[]
    ,_ws_status:'init'
    ,sendWSMessage:function(sendDt){
        if(sendDt){
            sendDt.uID = oojs$.getCookie('uID');
        }
        var self = this;
        if(self._ws == null){
            var host = window.document.location.host.replace(/:.*/, '');
            
            this._ws = new WebSocket('ws://' + location.hostname+(location.port ? ':'+location.port: ''));
            self._ws.onopen = function(){
                self._ws_status = "open";
                if(self._ws_catch.length>0){
                    for(var i = 0; i < self._ws_catch.length; i++){
                        self._ws.send(JSON.stringify(self._ws_catch[i]));
                    }
                }
            };
            self._ws.onmessage = function(evt){
                //console.log('main',evt.data);
                var jsonObj = JSON.parse(evt.data);
                if(jsonObj.hasOwnProperty('type')){
                    oojs$.dispatch(jsonObj['type'],jsonObj);
                }
            };
            self._ws.onerror = function (e) {
                self._ws = null;
            };
            self._ws.onclose = function () {
                self._ws = null;
                self._ws_status = "init"
            };
        }

        if(self._ws_status == "init"){
            if(sendDt.hasOwnProperty(type)){
                self._ws_catch.push(sendDt);
            }
        }else{
            if(sendDt.hasOwnProperty(type)){
                self._ws.send(JSON.stringify(sendDt));
            }
        }
    }

	,_events:{}

	,addEventListener: function(eventName, callback, scope){
        if(!callback){return;}
		this._events[eventName] = this._events[eventName] || [];
        for (var i = 0, len = this._events[eventName].length; i < len; i++) 
        {
            if(this._events[eventName][i] === callback ){
                return;
            }
        }
        callback['scope'] = scope;
        this._events[eventName].push(callback);
	}

    ,removeEventListener: function(eventName, callback){
        var events = this._events[eventName];
        for(var i = 0, len = events.length; i < len; i++){
            if(callback === events[i]){
                if(events[i]['scope']){
                    events[i]['scope'] = null;
                    delete events[i]['scope'];
                }
                events[i] = null;
                events.splice(i,1);
            }
        }
    }

    ,clearEventListener: function(eventName, callback){
        var events = this._events[eventName];
        for(var i = 0, len = events.length; i < len; i++){
            if(events[i]['scope']){
                events[i]['scope'] = null;
                delete events[i]['scope'];
            }
            events[i] = null;
        }
        delete this._events[eventName];
    }

	,dispatch:function(eventName, _){
        /**
         * function f(){console.log(arguments)}
		 * oojs$.addEventListener("ready",f);
		 * oojs$.dispatch("ready");
         * oojs$.removeEventListener("ready",f);
         * oojs$.dispatch("ready");
         */
		var events = this._events[eventName];
		var args = Array.prototype.slice.call(arguments, 1);
		if (!events)
		{
			return;
		}
		for (var i = 0, len = events.length; i < len; i++) 
		{
			events[i].apply(events[i]['scope'], args);
		}
	}
    /***
     * usage
     * oojs$.generateSelect(select,data)
     * param
     * select: $('<select></select>',{id:'id'})
     * data:{"used":1,"data":[{"ID":0,"NAME":"name0"},{"ID":1,"NAME":"name1"},{"ID":2,"NAME":"name2"}]} 
     *
     */
    ,generateSelect: function(select,data){
        if( select && data.hasOwnProperty('data') && data.data.length>0 ){
            for( var i = 0; i < data.data.length; i++ ){
                select.append("<option  value='"+data.data[i].ID+"'>"+data.data[i].NAME+"</option>")
            }
            if(data.hasOwnProperty('used')){
                select.val(data.data.used);
            }
        }
    }
    /***
     * usage
     * oojs$.fetch_paramName(data)
     * data:{"used":1,"data":[{"ID":0,"NAME":"name0"},{"ID":1,"NAME":"name1"},{"ID":2,"NAME":"name2"}]} 
     */
    ,fetch_paramName:function(data){
        if(  data.hasOwnProperty('used') &&data.hasOwnProperty('data') && data.data.length>0 ){
            for(var i = 0; i < data.data.length; i++ ){
                if(String(data.data[i].ID) == String(data.used)){
                    return String(data.data[i].NAME)
                }
            }
        }
        return '';
    }
    /***
     * usage
     * oojs$.appendTB_list(panel,list_head,list_body)
     * param
     * panel: div
     * list_head: [{ID:"COL1",NAME:"title1"},{ID:"COL2",NAME:"title2"}]
     * list_body: [
     * {
     *      "COL1":{ ELEMENT:"value1" },
     *      "COL2":{ ELEMENT:"value2" }
     * }
     * ,
     * {
     *      "COL1":{ ELEMENT:"value1" },
     *      "COL2":{ ELEMENT:"value2" }
     * }
     * ]
     *
     */
    ,appendTB_list : function(panel,list_head,list_body){
        panel.empty();
        if(list_head && list_head.length > 0
            && list_body && list_body.length > 0){
            var tb = $('<table></table>', {
                'class':'display dataTable'
            }).appendTo(panel);

            var thead = $('<thead></thead>').appendTo(tb);
            var tr = $('<tr></tr>').appendTo(thead);
            for(var elm = 0; elm < list_head.length; elm++){
                if(!list_body[0].hasOwnProperty( list_head[elm]["ID"] )){
                    continue;
                }
                var th = $('<th></th>',{
                    'class':"ui-state-default"
                }).appendTo(tr).text(list_head[elm]["NAME"]);
            }

            var tbody = $('<tbody></tbody>').appendTo(tb);
            for( var elm = 0; elm < list_body.length; elm++ ){
                var tr = null;
                if(elm%2 == 0){
                    tr = $('<tr></tr>',{'class':"even"}).appendTo(tbody);
                }else{
                    tr = $('<tr></tr>',{'class':"odd"}).appendTo(tbody);
                }
                var td = null;
                for(var in_elm = 0; in_elm < list_head.length; in_elm++){
                    if(!list_body[elm].hasOwnProperty( list_head[in_elm]["ID"] )){
                        continue;
                    }
                    td = $('<td></td>').appendTo(tr);
                    td.append(list_body[elm][ list_head[in_elm]["ID"] ]['ELEMENT']);
                }
            }
        }
    }


    /***
     * usage
     * oojs$.appendTB_item_D2(tb,list_head,item)
     * param
     * panel: tb
     * head: [{ID:"COL1",NAME:"title1"},{ID:"COL2",NAME:"title2"},{ID:"COL3",NAME:"title3"},{ID:"COL4",NAME:"title4"}]
     * item: {
	 * "COL1":{ ELEMENT:"value1" },
	 * "COL2":{ ELEMENT:"value2" },
	 * "COL3":{ ELEMENT:"left",ELEMENT1:'right-up',ELEMENT2:'right-down',ROWSPAN:2},//"COL3":{ ELEMENT:"left",ELEMENT1:'right-up'},ELEMENT2:'right-mid',ELEMENT3:'right-down',ROWSPAN:3},
     * "COL4":{ ELEMENT:"only one cell",COLSPAN:2}
     * }
     *
     *(D2 identify 2 col )
     */
    ,appendTB_item_D2 : function(tb,head,item){
        var tr = null;
        var ROWSPAN = "";
        var COLSPAN = "";
        var int_ROWSPAN = 0;
        var tmpClass = "";
        for(var i = 0; i < head.length; i++){

            if(!item.hasOwnProperty(head[i]["ID"])){
                continue;
            }
            ROWSPAN = "";
            COLSPAN = "";
            if(item[head[i]["ID"]].hasOwnProperty("ROWSPAN")){
                ROWSPAN = String(item[head[i]["ID"]]["ROWSPAN"]);
            }
            if(item[head[i]["ID"]].hasOwnProperty("COLSPAN")){
                COLSPAN = String(item[head[i]["ID"]]["COLSPAN"]);
            }
            if(ROWSPAN == ""){
                if(i%2==0){
                    tr = $('<tr></tr>',{'class':"even"}).appendTo(tb);
                }else{
                    tr = $('<tr></tr>',{'class':"odd"}).appendTo(tb);
                }
                if(COLSPAN == ""){
                	//width:100px;
                    $('<td></td>',{ 'class':"td",style:"max-width:46px"}).appendTo(tr).text(head[i]["NAME"]+": ");
                    $('<td></td>',{ 'class':"td"}).appendTo(tr).append(item[head[i]["ID"]]["ELEMENT"]);
                }else if(COLSPAN == "2"){
                    $('<td></td>',{ 'colspan':"2",'align':"center",'valign':"bottom"}).appendTo(tr).append(item[head[i]["ID"]]["ELEMENT"]);
                }else{
                    throw "the value of COLSPAN not allowed"+COLSPAN;
                }
            }else{
                int_ROWSPAN = parseInt(ROWSPAN);
                if(int_ROWSPAN<2){
                    throw "the value of ROWSPAN not allowed"+ROWSPAN;
                }

                if(i%2==0){
                    tmpClass = "even";
                }else{
                    tmpClass = "odd";
                }

                tr = $('<tr></tr>',{'class':tmpClass}).appendTo(tb);
                $('<td></td>',{ 'rowspan':int_ROWSPAN}).appendTo(tr).text(head[i]["NAME"]+": ");
                $('<td></td>',{ }).appendTo(tr).append(item[head[i]["ID"]]["ELEMENT1"]);
                for(var j = 0; j < int_ROWSPAN-1; j++)
                {
                    tr = $('<tr></tr>',{'class':tmpClass}).appendTo(tb);
                    $('<td></td>',{  }).appendTo(tr).append(item[head[i]["ID"]]["ELEMENT2"]);
                }

            }
        }
    }

    /***
     * usage
     * oojs$.appendTB_item_D2x(tb,item_D2)
     * param
     * panel: tb
     *
     * item_D2: [
     * { 'COLUMN1':"value1", 'COLUMN2':"value2" },
     * { 'COLUMN1':"value1", 'COLUMN2':"value2"},
     * { 'COLUMN1':"left",COLUMN2:'right-up',COLUMN3:'right-down',ROWSPAN:2},
     * { 'COLUMN1':"only one cell",COLSPAN:2}
     * ]
     *
     *(D2x identify 2 column but not head limit body)
     */
    ,appendTB_item_D2x:function(tb,item_D2){
        var tr = null;
        var ROWSPAN = "";
        var COLSPAN = "";
        var int_ROWSPAN = 0;
        var tmpClass = "";
        for(var i = 0; i < item_D2.length; i++){
            ROWSPAN = "";
            COLSPAN = "";

            if(item_D2[i].hasOwnProperty("ROWSPAN")){
                ROWSPAN = String(item_D2[i]["ROWSPAN"]);
            }else if(item_D2[i].hasOwnProperty("COLSPAN")){
                COLSPAN = String(item_D2[i]["COLSPAN"]);
            }

            if(ROWSPAN == ""){

                if(i%2==0){
                    tr = $('<tr></tr>',{'class':"even"}).appendTo(tb);
                }else{
                    tr = $('<tr></tr>',{'class':"odd"}).appendTo(tb);
                }

                if(COLSPAN == ""){
                    $('<td></td>',{ 'class':"td"}).appendTo(tr).append(item_D2[i]["COLUMN1"] );
                    $('<td></td>',{ 'class':"td"}).appendTo(tr).append(item_D2[i]["COLUMN2"]);
                }else if(COLSPAN == "2"){
                    $('<td></td>',{ 'colspan':"2",'align':"center",'valign':"bottom"}).appendTo(tr).append(item_D2[i]["COLUMN1"]);
                }else{
                    throw "the value of COLSPAN not allowed"+COLSPAN;
                }
            }else{
                int_ROWSPAN = parseInt(ROWSPAN);
                if(int_ROWSPAN<2){
                    throw "the value of ROWSPAN not allowed"+ROWSPAN;
                }

                if(i%2==0){
                    tmpClass = "even";
                }else{
                    tmpClass = "odd";
                }
                tr = $('<tr></tr>',{'class':tmpClass}).appendTo(tb);
                $('<td></td>',{ 'rowspan':int_ROWSPAN}).appendTo(tr).append(item_D2[i]["COLUMN1"] );
                $('<td></td>',{ }).appendTo(tr).append(item_D2[i]["ELEMENT2"]);
                for(var j = 0; j < int_ROWSPAN-1; j++)
                {
                    tr = $('<tr></tr>',{'class':tmpClass}).appendTo(tb);
                    $('<td></td>',{  }).appendTo(tr).append(item_D2[i]["ELEMENT"+(j+3)]);
                }

            }
        }
    }

	,heartID:null

	,heartTime:function(){
        var self = this;
		if(self.heartID==null){
			self.heartID = setInterval(function(){
                //self.closeHeartTime();
				$.ajax({
					type:"get",
					url:"/heartTime",
					async:false,
					dataType:"json",
					success:function(result,textStatus){
						if(result.success){
							//console.log( "success!" );
                            self.heartTime();
						}else{
                            self.closeHeartTime();
							oojs$.showError(result.message,function(){
                                window.location.href = "/";
                            });
						}
					},
					beforeSend: function(xhr){
						xhr.withCredentials = true;
					}
                    //
                    ,
                    xhr: function() {
                        // create an XMLHttpRequest
                        var xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function () {
                            if (xhr.readyState == 4) {
                                if (xhr.status == 404) {
                                    // I can live with that, log it and go on
                                    alert("404");
                                    console.log("file missing");
                                }
                                else {
                                    // Wohoo, all is fine, do loading stuff
                                }
                            }
                            // listen to the 'progress' event
                            return xhr;
                        }
                    }
           
                    //
				});

			},30*1000);
		}
	}

    ,closeHeartTime:function(){
        var self = this;
		clearInterval( self.heartID);
        self.heartID = null;
    }
    ,valideString:function(val){
        val = String(val);
        return (val.trim() === 'undefined' || val.trim() == "null" || val.length <= 0) ? "" : val;
    }
    ,valideDate:function(){
        var str_date = arguments[0];
        if(oojs$.matchYMD(str_date))
        {
        	return str_date;
        }else{
        	return oojs$.Format(new Date(),"yyyy-MM-dd");
        }
    }
    ,valide6letter:function(){
        if(arguments[0].match(/^[a-zA-Z0-9]{6}$/)){
            return true;
        }else{
            return false;
        }
    }
    ,getPanelID: function(){
        return $('#accordion').accordion('option','active');
    }
    ,showPanel: function(){
        hideAllPanel();
        var active = $('#accordion').accordion('option','active');
        switch(active){
            case 0:
                $('#dictTrade_panel').show()
                break;
            case 1:
                $('#policy_panel').show()
                break;
            case 2:
                $('#JsonView_panel').show()
                break;
            case 3:
                $('#market_panel').show()
                break;
            case 4:
                $('#user_panel').show()
                break;
            case 5:
                $('#_panel').show()
                break;
        }
    }

};

</script>
<!--
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-->
<script type="text/javascript">

oojs$.ns("com.stock.Space");
oojs$.com.stock.Space = oojs$.createClass(
{
    type:"space"
    ,suf:null
    ,init:function(div, obj_json, fun_policy){
        var self = this;
        if(obj_json!=null ){
            $("<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>").appendTo(div);
            if(
                obj_json.hasOwnProperty('suf')
                && obj_json['suf']
            ){
                self.div = $('<div></div>',{style:"display:inline"});
                div.append(self.div);
                if(fun_policy!=null){
                    self.suf = fun_policy(self.div, obj_json['suf'],fun_policy);
                }
            }
        }   
    }
    ,val:function(){
        var self = this;
        if( self.suf != null ){
            return self.suf.val();
        }else{
            return null;
        }
    }
});


oojs$.ns("com.stock.Label");
oojs$.com.stock.Label = oojs$.createClass(
{
    type:"label"
    ,suf:null
    ,div:null
    ,init:function(div, obj_json, fun_policy){
        var self = this;
        
        if(obj_json!=null ){
            if(
                obj_json.hasOwnProperty('value')
                && obj_json['value']
            ){
                $('<label></label>').text(obj_json['value']).appendTo(div);
            }
            
            if(
                obj_json.hasOwnProperty('suf')
                && obj_json['suf']
            ){
                self.div = $('<div></div>',{style:"display:inline"});
                div.append(self.div);
                if(fun_policy!=null){
                    self.suf = fun_policy(self.div, obj_json['suf'],fun_policy);
                }
            }
        }   
    }
    ,val:function(){
        var self = this;
        if( self.suf != null ){
            return self.suf.val();
        }else{
            return null;
        }
    }
});


oojs$.ns("com.stock.Input");
oojs$.com.stock.Input = oojs$.createClass(
{
    type:'input'
    ,id:''
    ,value:''
    ,div:null
    ,suf:null
    ,tag_input:null
    ,init:function(div, obj_json, fun_policy){
        var self = this;
        if(obj_json!=null ){
            self.obj_json = obj_json;
            if(
                obj_json.hasOwnProperty('id')
                && obj_json['id']
                
            ){
                self.id = obj_json['id'];
                self.value = obj_json['value'];
                self.tag_input = $('<input></input>',
                {
                    'type':'text'
                })
                .appendTo(div);

                if( 
                    obj_json.hasOwnProperty('value')
                    && obj_json['value']
                ){
                    self.tag_input
                    .val(obj_json['value'])
                }

                if(
                    obj_json.hasOwnProperty('suf')
                    && obj_json['suf']
                ){
                    self.div = $('<div></div>',{style:"display:inline"});
                    div.append(self.div);
                    if(fun_policy!=null){
                        self.suf = fun_policy(self.div, obj_json['suf'],fun_policy);
                    }
                }
            }
        }
    }
    ,val:function(){
        var self = this;
        var obj = {};
        obj[self.id] = self.tag_input.val();
        if( self.suf != null ){
            obj.suf = self.suf.val();
            return obj;
        }else{
            return obj;
        }
    }
});

oojs$.ns("com.stock.Select");
oojs$.com.stock.Select = oojs$.createClass(
{
    type:"select"
    ,id:null
    ,key:null
    ,value:null
    ,default:null
    ,div_parent:null
    ,div_self:null
    ,suf:null
    ,obj_json:null
    ,fun_policy:null
    ,tag_select:null
    ,init:function(div, obj_json, fun_policy){
        var self = this;
        self.fun_policy = fun_policy;
        self.div_parent = div;
        if(obj_json!=null ){
            self.obj_json = obj_json;
            if(
                obj_json.hasOwnProperty('id')
                && obj_json['id']
                && obj_json.hasOwnProperty('key')
                && obj_json['key']
                && obj_json.hasOwnProperty('value')
                && obj_json['value']
            ){
                self.id = obj_json['id'];
                self.key = obj_json['key'];
                self.value = obj_json['value'];
                if(self.key.length!=self.value.length  ){
                    oojs$.showError("jsonview length not match!");
                    return;
                }else
                {
                    self.tag_select = $('<select ></select>',{
                        style:"height:25px;-webkit-appearance: none;-moz-appearance: none;-o-appearance: none;"
                    }).appendTo(div).change(
                    {'scope':self},
                    self.select_change
                    );

                    for(var id = 0; id < self.value.length; id++){
                        $('<option value="'+self.key[id]+'">'+self.value[id]+'</option>').appendTo(self.tag_select);
                    }
                    if(
                        obj_json.hasOwnProperty('default')
                        && obj_json['default']
                    ){
                        self.default = obj_json['default'];
                        self.hand_suf();
                    }
                }
            }
        }   
    }
    ,val:function(){
        var self = this;
        var obj = {};
        obj[self.id]= self.default;
        if( self.suf != null ){
            obj.suf = self.suf.val();
            return obj;
        }else{
            return obj;
        }
    }
    ,select_change:function(event){
        var self = event.data['scope'];
        var div = event.data['div'];
        console.log($(this).val());
        self.default = $(this).val();
        self.hand_suf();
    }
    ,hand_suf:function(){
        var self = this;

        if(self.div_self!=null){
            self.div_self.empty();               
        }else{
            self.div_self = $('<div></div>',{style:"display:inline"});
        }

        self.suf = null;

        if(
            self.default!=null
        ){
            self.tag_select.val(self.default);
            if(
                self.obj_json.hasOwnProperty('suf')
                && self.obj_json['suf']
            ){
                if(self.fun_policy!=null){
                    for(var id_suf = 0; id_suf < self.value.length; id_suf++){
                        if(self.default == self.key[id_suf]){
                            if(self.obj_json['suf'][id_suf]!=null){
                                
                                self.div_parent.append(self.div_self);
                                self.suf = self.fun_policy(self.div_self, self.obj_json['suf'][id_suf],self.fun_policy);
                            }
                        }
                    }
                }
            }
        }
    }
});

oojs$.ns("com.stock.Check");
oojs$.com.stock.Check = oojs$.createClass(
{
    type:"check"
    ,id:null
    ,key:null
    ,value:null
    ,default:null
    ,suf:null
    ,div:null
    ,checks:null
    ,result:null
    ,init:function(div, obj_json){
        var self = this;
        self.div_parent = div;
        if(obj_json!=null ){
            if(
                obj_json.hasOwnProperty('id')
                && obj_json['id']
                && obj_json.hasOwnProperty('key')
                && obj_json['key']
                && obj_json.hasOwnProperty('value')
                && obj_json['value']
            ){
                
                self.id = obj_json['id'];
                self.key = obj_json['key'];
                self.value = obj_json['value'];

                if(self.key.length!=self.value.length  ){
                    oojs$.showError("jsonview_check length not match!");
                    return;
                }else{
                    div.prop('style','display:inline-block');
                    var table = $('<table></table>',{}).appendTo(div);
                    if(self.checks == null){self.checks=[]}
                    for(var id_ck = 0; id_ck < self.value.length; id_ck++){
                        
                        var tr = $('<tr></tr>').appendTo(table);
                        var td = $('<td></td>',{style:'padding:0;font-family:Microsoft YaHei, Verdana, Geneva, sans-serif;font-size: 10px;'}).appendTo(tr);

                        var check = $('<input></input>',{
                            'type':'checkbox'
                            ,'name':self.key[id_ck]
                        })
                        .appendTo(td)
                        .change(
                            {'scope':self},
                            self.check_change
                        );
                        self.checks.push(check)
                        $('<label></label>').text(self.value[id_ck])
                        .appendTo(td);
                    }
                    self.result = {}
                    for(var id = 0; id < self.checks.length; id++)
                    {
                        self.result[self.checks[id].prop('name')] = self.checks[id].is(':checked')
                    }
                }
            }
        }
    }
    ,val:function(){
        var self = this;
        var obj = {};
        obj[self.id]= self.result;
        if( self.suf != null ){
            obj.suf = self.suf.val();
            return obj;
        }else{
            return obj;
        }
    }
    ,check_change:function(event){
        var self = event.data.scope;
        var div = event.data['div'];
        self.result = {}
        for(var id = 0; id < self.checks.length; id++)
        {
            self.result[self.checks[id].prop('name')] = self.checks[id].is(':checked')
        }
    }
});

</script>
<!--
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-->
<script type="text/javascript">

//--------------------------------------------------------------------------------
oojs$.ns("com.stock.JsonView");
oojs$.com.stock.JsonView = oojs$.createClass(
{
    tb:null
    ,frame_jsonView:null
    ,frame_jsonData:null
    ,jsonData:null

    ,init:function(){
        var self = this;
        self.draw_jsonData();
        self.draw_jsonView();
    }

    ,fun_policy:function(div,obj_json,fun_plcy){
        var tag = null;
        switch(obj_json['type']){
            case 'label':
                tag = new oojs$.com.stock.Label();
                tag.init(div,obj_json,fun_plcy);
                return tag;
            case 'input':
                tag = new oojs$.com.stock.Input();
                tag.init(div,obj_json,fun_plcy);
                return tag ;
            case 'select':
                tag = new oojs$.com.stock.Select();
                tag.init(div,obj_json,fun_plcy);
                return tag;
            case 'check':
                tag = new oojs$.com.stock.Check();
                tag.init(div,obj_json,fun_plcy);
                return tag;
            case 'space':
                tag = new oojs$.com.stock.Space();
                tag.init(div,obj_json,fun_plcy);
                return tag;
            default :
                return null;
        }
    }
    ,draw_jsonData:function(){
        var self = this;
        if(self.frame_jsonData == null){
            self.frame_jsonData = $('#frame_jsonData');
        }
        self.frame_jsonData.empty();
        var textarea = $('<textarea></textarea>',{style:'width:80%;'}).appendTo(self.frame_jsonData);
        var btn = $('<input></input>',{type:"button",value:"生成视图"}).appendTo(self.frame_jsonData).click(
            {'scope':self,'textarea':textarea},
            self.btn_generateView
        );

        self.frame_jsonData.append(btn)
    }
    ,draw_jsonView:function(){
        var self = this;
        if(self.frame_jsonView == null){
            self.frame_jsonView = $('#frame_jsonView');
        }
        self.frame_jsonView.empty();
        var tags = [];
        /****
        self.jsonData = [  
           {  
              "type":"label",
              "value":"请输入最大值",
              "suf":{  
                 "type":"space",
                 "suf":{  
                    "type":"input",
                    "id":"input_id",
                    "value":"",
                    "suf":{  
                       "type":"label",
                       "value":"输入值1",
                       "suf":{  
                          "type":"check",
                          "id":"check_id",
                          "key":[  
                             "ck1",
                             "ck2",
                             "ck3",
                             "ck4"
                          ],
                          "value":[  
                             "多选1",
                             "多选2",
                             "多选3",
                             "多选4"
                          ],
                          "default":[  
                             0,
                             1,
                             0,
                             1
                          ]
                       }
                    }
                 }
              }
           },
           {  
              "type":"label",
              "value":"请选择",
              "suf":{  
                 "type":"select",
                 "id":"select_id",
                 "key":[  
                    "abc",
                    "bcd"
                 ],
                 "value":[  
                    "请输入最大值",
                    "请输入最小值"
                 ],
                 "default":"abc",
                 "suf":[  
                    {  
                       "type":"label",
                       "value":"下一个用例",
                       "suf":{  
                          "type":"input",
                          "id":"input_id2",
                          "value":""
                       }
                    },
                    null
                 ]
              }
           }
        ]
        /****/
        if(self.jsonData!=null){
            for(var id = 0; id < self.jsonData.length; id++){
                if(self.jsonData[id] == null){continue;}
                var div = $('<div></div>',{}).appendTo(self.frame_jsonView);
                if(self.jsonData[id]['type'] == "label"){
                    var root = self.fun_policy(div,self.jsonData[id],self.fun_policy);
                    tags.push(root);
                    
                }
            }

            var textarea = $('<textarea></textarea>',{style:'width:80%;'});
            var btn = $('<input></input>',{type:"button",value:"获得结果"}).appendTo(div).click(
                {'scope':self,'tags':tags,'textarea':textarea},
                self.btn_detail
            );
            self.frame_jsonView.append(btn);
            self.frame_jsonView.append(textarea);
        }

        $('<textarea></textarea>',{style:'width:80%;'})
        .val('[{"type":"label","value":"请输入最大值","suf":{"type":"input","id":"input_id","value":"","suf":{"type":"label","value":"输入值1","suf":{"type":"check","id":"check_id","key":["ck1","ck2","ck3","ck4"],"value":["多选1","多选2","多选3","多选4"],"default":[0,1,0,1]}}}},{"type":"label","value":"请选择","suf":{"type":"select","id":"select_id","key":["abc","bcd"],"value":["请输入最大值","请输入最小值"],"default":"abc","suf":[{"type":"label","value":"下一个用例","suf":{"type":"input","id":"input_id2","value":""}},null]}}]')
        .appendTo(self.frame_jsonView);
    }
    ,btn_detail:function(event){
        var self = event.data.scope;
        var tags = event.data.tags;
        var textarea = event.data.textarea;
        var result = [];
        for(var idx = 0; idx < tags.length; idx++){
            result.push(tags[idx].val())
        }
        textarea.val(JSON.stringify(result));

    }
    ,btn_generateView:function(event){
        var self = event.data.scope;
        var textarea = event.data.textarea;
        console.log(textarea.val())
        if($.trim(textarea.val())!=''){
            self.jsonData = JSON.parse(textarea.val());
            self.draw_jsonView();
        }

    }
});

var jsonView = new oojs$.com.stock.JsonView();
oojs$.addEventListener("ready",function(){
    jsonView.init();
});

$(document).ready(function(){
    oojs$.dispatch("ready");
})
</script>

</head>
    <body>
        <div class="content">
        <div class="box ui-widget" >
            <div id="frame_jsonData" class="ui-widget">
            </div>
            <div id="frame_jsonView" class="ui-widget">
            </div>
        </div>
        </div>
    </body>
</html>
